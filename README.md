# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс карточки товара

```
export interface IItem {
    _id:string;
    name:string;
    description:string;
    price:number | null;
    category:string[];
    image:string;
    satus:string;

}
```

Интерфейс данных пользователя

```
interface IContact {
	adress: string;
	email: string;
	phone: string;
	paymethod: string;
	setEmail(email: string): void;
	setPhone(phone: string): void;
	clear(): void;
}

```

Интерфейс для каталога карточек товара

```
export interface IItemsCatalog {
	items: IItem[];
	setItem(item: IItem[]): void;
	getItem(id: string): IItem;
}
```

Интерфейс АПИ получения данных

```
export interface IItemAPI {
	getItems: () => Promise<IItem[]>;
	getItem: (id: string) => Promise<IItem>;
	orderItems: (order: IContact) => Promise<IOrderResult>;
}
```

Интерфейс корзины

```
export interface IBasketModel {
	items: IBasketItem;
	add(id: string): void;
	remove(id: string): void;
	total: string | number;
}
```

Данные карточки товара для корзины

```
type IBasketItem = Pick<IItem, 'name' | 'price'>;
```

Типы для модальных окон: платеж и адрес, почта и телефон

```
export type TPayInfo = Pick<IContact, 'adress' | 'paymethod'>;
export type TOrderInfo = Pick<IContact, 'email' | 'phone'>;
```

Интерфейс для формы заказа

```
export interface IOrderFormData {
	contacts: IContact;
	isActive: boolean;
	isDisabled: boolean;
	message: string;
	total: string;
	isError: boolean;
}
```

Интерфейс для работы с настройками формы заказа

```
export interface IOrderFormSettings {
	onChange: (data: IContact) => void;
	onClose: () => void;
	onNext: () => void;
	onBack: () => void;
}
```

Интерфейс состояния заполненной формы заказа

```
interface IFormState {
	valid: boolean;
	errors: string[];
}
```

Интерфейс полученного заказа

```
export interface IOrderResult {
	id: string;
}
```

Отображение для заданного типа данных

```
interface IView {
	render(data?: object): HTMLElement;
}
```

Отображение корзины

```
interface IBasketView {
    id:string;
	items: HTMLElement[];
	total: number;
}
```

Отображение для карточек товара

```
interface IViewContainer {
	new (container: HTMLElement, events?: IEvents): IView;
}
```

Отображение для формы заказа

```
interface IFormOrder {
	new (container: HTMLElement, events?: IEvents): IView;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс API

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: -`get` - выполняет GET запрос на переданный в параметрах ендпойнт и возвращает промис с объектом, которым ответил сервер;

- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпойнт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интрефейсом `IEvents`:

- `on` - подписка на событие; -`emit` - инициализация события; -`trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ItemsCatalog

Класс отвечает за хранение и логику работы с данными карточек товара, полученных от сервера.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- \_items: IItem[] - массив объектов карточек товаров.
- \_preview: string | null - id карточки товара, выбранной для просмотра в модальном окне;
- events: IEvents -экземпляр класса `EventEmitter` для инициации событий при изменении данных.
  Также в классе имеются методы для взаимодействия с этими данными.
- updateItem(item:IItem,payload:Function | null = null):void - обновляет данные карточки товара в корзине. Если передан колбэк, то выполняет его после обновления, еcли нет, то вызывает событие изменения массива.
- getItem - возвращает карточку товара по ее id.

#### Класс Contacts

Класс отвечает за хранение и логику работы с данными текущего пользователя.\
 Конструктор класса принимает инстант брокера событий.\
 В полях класса хранятся следующие данные:

- adress:string - адрес пользователя
- email:string - почта пользователя
- phone:string - телефон пользователя
- paymethod:string -выбранный пользователем способ оплаты
- \_id:string - уникальный идентификатор
- events: IEvents -экземпляр класса `EventEmitter` для инициации событий при изменении данных.

#### Класс BasketModel

Класс импелементирует интерфейс IBasketModel и отвечает за логику работы корзины.\
 События в классе:\
 events:IEvents;\
 Поля класса храят следующие данные:

- items:Map<string,number>; - название и цена товара;

Методы

- add(id: string):void - добавление в корзину по id;
- remove(id:string):void - удаление из корзины по id;
- protected \_changed() - изменение состояния корзины.

### Классы представления

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса

- modal: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий.

#### Класс ModalWithForm

Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:

- submitButton: HTMLButtonElement - Кнопка подтверждения
- \_form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithConfirm

Расширяет класс Modal. Предназначен для реализации модального окна подтверждения. При открытии модального окна сохраняет полученный в параметрах обработчик, который передается для выполнения при сабмите формы.\
Поля класса:

- submitButton: HTMLButtonElement - Кнопка подтверждения
- \_form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- handleSubmit: Function - функция, на выполнение которой запрашивается подтверждение

Методы:

- open(handleSubmit: Function): void - расширение родительского метода, принимает обработчик, который передается при инициации события подтверждения.
- get form: HTMLElement - геттер для получения элемента формы.

#### Класс ModalWithItem

Расширяет класс Modal. Предназначен для реализации модального окна с изображением карточки товара с описанием. При открытии модального окна получает название товара, категорию, описание, стоимость и данные изображения, которое нужно показать.\
Поля класса:

- ItemImage: HTMLImageElement - элемент разметки с изображением товара;
- ItemCaption: HTMLElement - элемент разметки для вывода названия товара;
- ItemDescription: HTMLElement - элемент разметки для вывода описания товара;
  -ItemPrice: HTMLElement - элемент разметки для вывода цены товара;
  -ItemCategory:: HTMLElement - элемент разметки для вывода категории товара;

Методы:

- add(item:IItem):IBasketItem- добавление товара в корзину.
- open(data: { name: string, image: string, price:number | null, category: string, description:string}): void - расширение родительского метода, принимает данные карточки товара, которые используются для заполнения атрибутов элементов модального окна.
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна.

#### Класс Item

Отвечает за отображение карточки товаров, задавая в карточке данные названия, изображения, описания, категории, цены, статуса "выбрано" текущим пользователем. Класс используется для отображения карточек товаров на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
 Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
 Методы:

- setData(itemData: IItem, userId: string): void - заполняет атрибуты элементов карточки данными;
- ischoosed(): boolean - метод возвращает значение выбрано или нет пользователем;
- deleteItem(): void - метод для удаления разметки карточки;
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями;
- геттер id возвращает уникальный id карточки товара.

#### Класс ItemsContainer

Отвечает за отображение блока с карточками товаров на главной странице.
В конструктор принимает контейнер, к котором размещаются карточки товаров.

#### Класс BasketView

Отвечает за отображение корзины. В конструктор принимает контейнер с выбранными пользователем товарами,который
содержит id товара, цену.
Поля:

- id:string;
- items: HTMLElement[];
- total: number(общая стоимость корзины).\
  Методы:
- render(data:{items:HTMLElement[]}):HTMLElement - отображение корзины с товарами и ценой;

#### Класс Contacts

Отвечает за блок с информацией о пользователе: адрес, почта, телефон, выбранный способ оплаты.

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и представляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.
_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделей данных)_

- `basket:changed` - изменение массива карточек в корзине;\
  -`item:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки товара;\
  _События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_\
   -`item:open` - открытие в модальном окне карточки товара;\
   -`basket:delete` - удаление товара из корзины;\
   -`basket:submit` - оформить заказ;\
   -`item:select` - выбор товара и добавление его в корзину;\
   -`order:input` - изменение данных в форме с данными пользователя;\
   -`order:submit` - сохранение данных пользователя в модальном окне;\
   -`order:validation` - событие, сообщающее о необходимости валидации формы заказа;\
   -`contacts:input` - изменение данных в форме с контактами пользователя;\
   -`contacts:validation` - событие, сообщающее о необходимости валидации формы заказа.
